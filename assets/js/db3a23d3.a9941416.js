"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[2715],{35318:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return m}});var n=a(27378);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(a),m=i,v=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return a?n.createElement(v,r(r({ref:t},p),{},{components:a})):n.createElement(v,r({ref:t},p))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var c=2;c<o;c++)r[c]=a[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},6746:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return d},contentTitle:function(){return m},metadata:function(){return v},toc:function(){return h},default:function(){return f}});var n=a(35318),i=Object.defineProperty,o=Object.defineProperties,r=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,p=(e,t,a)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,u=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&p(e,a,t[a]);if(l)for(var a of l(t))c.call(t,a)&&p(e,a,t[a]);return e};const d={id:"native-modules-android",title:"Native Modules"},m=void 0,v={unversionedId:"native-modules-android",id:"version-0.62/native-modules-android",title:"Native Modules",description:"Sometimes an app needs access to a platform API that React Native doesn't have a corresponding module for yet. Maybe you want to reuse some existing Java code without having to reimplement it in JavaScript, or write some high performance, multi-threaded code such as for image processing, a database, or any number of advanced extensions.",source:"@site/versioned_docs/version-0.62/native-modules-android.md",sourceDirName:".",slug:"/native-modules-android",permalink:"/docs/0.62/native-modules-android",editUrl:"https://github.com/facebook/react-native-website/blob/master/website/../docs/native-modules-android.md",tags:[],version:"0.62",lastUpdatedAt:1648760516,formattedLastUpdatedAt:"4/1/2022",frontMatter:{id:"native-modules-android",title:"Native Modules"},sidebar:"version-0.62/docs",previous:{title:"Direct Manipulation",permalink:"/docs/0.62/direct-manipulation"},next:{title:"Native UI Components",permalink:"/docs/0.62/native-components-android"}},h=[{value:"Native Module Setup",id:"native-module-setup",children:[{value:"Enable Gradle",id:"enable-gradle",children:[],level:3}],level:2},{value:"The Toast Module",id:"the-toast-module",children:[{value:"Argument Types",id:"argument-types",children:[],level:3},{value:"Register the Module",id:"register-the-module",children:[],level:3}],level:2},{value:"Beyond Toasts",id:"beyond-toasts",children:[{value:"Callbacks",id:"callbacks",children:[],level:3},{value:"Promises",id:"promises",children:[],level:3},{value:"Threading",id:"threading",children:[],level:3},{value:"Sending Events to JavaScript",id:"sending-events-to-javascript",children:[],level:3},{value:"Getting activity result from <code>startActivityForResult</code>",id:"getting-activity-result-from-startactivityforresult",children:[],level:3},{value:"Listening to LifeCycle events",id:"listening-to-lifecycle-events",children:[],level:3}],level:2}],g={toc:h};function f(e){var t,a=e,{components:i}=a,p=((e,t)=>{var a={};for(var n in e)s.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&l)for(var n of l(e))t.indexOf(n)<0&&c.call(e,n)&&(a[n]=e[n]);return a})(a,["components"]);return(0,n.kt)("wrapper",(t=u(u({},g),p),o(t,r({components:i,mdxType:"MDXLayout"}))),(0,n.kt)("p",null,"Sometimes an app needs access to a platform API that React Native doesn't have a corresponding module for yet. Maybe you want to reuse some existing Java code without having to reimplement it in JavaScript, or write some high performance, multi-threaded code such as for image processing, a database, or any number of advanced extensions."),(0,n.kt)("p",null,"We designed React Native such that it is possible for you to write real native code and have access to the full power of the platform. This is a more advanced feature and we don't expect it to be part of the usual development process, however it is essential that it exists. If React Native doesn't support a native feature that you need, you should be able to build it yourself."),(0,n.kt)("h2",u({},{id:"native-module-setup"}),"Native Module Setup"),(0,n.kt)("p",null,"Native modules are usually distributed as npm packages, apart from the typical javascript files and resources they will contain an Android library project. This project is (from NPM's perspective) similar to any other media asset, meaning there isn't anything unique about it from this point of view. To get the basic scaffolding make sure to read ",(0,n.kt)("a",u({parentName:"p"},{href:"native-modules-setup"}),"Native Modules Setup")," guide first."),(0,n.kt)("h3",u({},{id:"enable-gradle"}),"Enable Gradle"),(0,n.kt)("p",null,"If you plan to make changes in Java code, we recommend enabling ",(0,n.kt)("a",u({parentName:"p"},{href:"https://docs.gradle.org/2.9/userguide/gradle_daemon.html"}),"Gradle Daemon")," to speed up builds."),(0,n.kt)("h2",u({},{id:"the-toast-module"}),"The Toast Module"),(0,n.kt)("p",null,"This guide will use the ",(0,n.kt)("a",u({parentName:"p"},{href:"http://developer.android.com/reference/android/widget/Toast.html"}),"Toast")," example. Let's say we would like to be able to create a toast message from JavaScript."),(0,n.kt)("p",null,"We start by creating a native module. A native module is a Java class that usually extends the ",(0,n.kt)("inlineCode",{parentName:"p"},"ReactContextBaseJavaModule")," class and implements the functionality required by the JavaScript. Our goal here is to be able to write ",(0,n.kt)("inlineCode",{parentName:"p"},"ToastExample.show('Awesome', ToastExample.SHORT);")," from JavaScript to display a short toast on the screen."),(0,n.kt)("p",null,"Create a new Java Class named ",(0,n.kt)("inlineCode",{parentName:"p"},"ToastModule.java")," inside ",(0,n.kt)("inlineCode",{parentName:"p"},"android/app/src/main/java/com/your-app-name/")," folder with the content below:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'// ToastModule.java\n\npackage com.your-app-name;\n\nimport android.widget.Toast;\n\nimport com.facebook.react.bridge.NativeModule;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.bridge.ReactContext;\nimport com.facebook.react.bridge.ReactContextBaseJavaModule;\nimport com.facebook.react.bridge.ReactMethod;\n\nimport java.util.Map;\nimport java.util.HashMap;\n\npublic class ToastModule extends ReactContextBaseJavaModule {\n  private static ReactApplicationContext reactContext;\n\n  private static final String DURATION_SHORT_KEY = "SHORT";\n  private static final String DURATION_LONG_KEY = "LONG";\n\n  ToastModule(ReactApplicationContext context) {\n    super(context);\n    reactContext = context;\n  }\n}\n')),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"ReactContextBaseJavaModule")," requires that a method called ",(0,n.kt)("inlineCode",{parentName:"p"},"getName")," is implemented. The purpose of this method is to return the string name of the ",(0,n.kt)("inlineCode",{parentName:"p"},"NativeModule")," which represents this class in JavaScript. So here we will call this ",(0,n.kt)("inlineCode",{parentName:"p"},"ToastExample")," so that we can access it through ",(0,n.kt)("inlineCode",{parentName:"p"},"React.NativeModules.ToastExample")," in JavaScript."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'  @Override\n  public String getName() {\n    return "ToastExample";\n  }\n')),(0,n.kt)("p",null,"An optional method called ",(0,n.kt)("inlineCode",{parentName:"p"},"getConstants")," returns the constant values exposed to JavaScript. Its implementation is not required but is very useful to key pre-defined values that need to be communicated from JavaScript to Java in sync."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"  @Override\n  public Map<String, Object> getConstants() {\n    final Map<String, Object> constants = new HashMap<>();\n    constants.put(DURATION_SHORT_KEY, Toast.LENGTH_SHORT);\n    constants.put(DURATION_LONG_KEY, Toast.LENGTH_LONG);\n    return constants;\n  }\n")),(0,n.kt)("p",null,"To expose a method to JavaScript a Java method must be annotated using ",(0,n.kt)("inlineCode",{parentName:"p"},"@ReactMethod"),". The return type of bridge methods is always ",(0,n.kt)("inlineCode",{parentName:"p"},"void"),". React Native bridge is asynchronous, so the only way to pass a result to JavaScript is by using callbacks or emitting events (see below)."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"  @ReactMethod\n  public void show(String message, int duration) {\n    Toast.makeText(getReactApplicationContext(), message, duration).show();\n  }\n")),(0,n.kt)("h3",u({},{id:"argument-types"}),"Argument Types"),(0,n.kt)("p",null,"The following argument types are supported for methods annotated with ",(0,n.kt)("inlineCode",{parentName:"p"},"@ReactMethod")," and they directly map to their JavaScript equivalents"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-text"}),"Boolean -> Bool\nInteger -> Number\nDouble -> Number\nFloat -> Number\nString -> String\nCallback -> function\nReadableMap -> Object\nReadableArray -> Array\n")),(0,n.kt)("p",null,"Read more about ",(0,n.kt)("a",u({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/ReactAndroid/src/main/java/com/facebook/react/bridge/ReadableMap.java"}),"ReadableMap")," and ",(0,n.kt)("a",u({parentName:"p"},{href:"https://github.com/facebook/react-native/blob/master/ReactAndroid/src/main/java/com/facebook/react/bridge/ReadableArray.java"}),"ReadableArray")),(0,n.kt)("h3",u({},{id:"register-the-module"}),"Register the Module"),(0,n.kt)("p",null,"The last step within Java is to register the Module; this happens in the ",(0,n.kt)("inlineCode",{parentName:"p"},"createNativeModules")," of your apps package. If a module is not registered it will not be available from JavaScript."),(0,n.kt)("p",null,"create a new Java Class named ",(0,n.kt)("inlineCode",{parentName:"p"},"CustomToastPackage.java")," inside ",(0,n.kt)("inlineCode",{parentName:"p"},"android/app/src/main/java/com/your-app-name/")," folder with the content below:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"// CustomToastPackage.java\n\npackage com.your-app-name;\n\nimport com.facebook.react.ReactPackage;\nimport com.facebook.react.bridge.NativeModule;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.uimanager.ViewManager;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\n\npublic class CustomToastPackage implements ReactPackage {\n\n  @Override\n  public List<ViewManager> createViewManagers(ReactApplicationContext reactContext) {\n    return Collections.emptyList();\n  }\n\n  @Override\n  public List<NativeModule> createNativeModules(\n                              ReactApplicationContext reactContext) {\n    List<NativeModule> modules = new ArrayList<>();\n\n    modules.add(new ToastModule(reactContext));\n\n    return modules;\n  }\n\n}\n")),(0,n.kt)("p",null,"The package needs to be provided in the ",(0,n.kt)("inlineCode",{parentName:"p"},"getPackages")," method of the ",(0,n.kt)("inlineCode",{parentName:"p"},"MainApplication.java")," file. This file exists under the android folder in your react-native application directory. The path to this file is: ",(0,n.kt)("inlineCode",{parentName:"p"},"android/app/src/main/java/com/your-app-name/MainApplication.java"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'// MainApplication.java\n\n...\nimport com.your-app-name.CustomToastPackage; // <-- Add this line with your package name.\n...\n\nprotected List<ReactPackage> getPackages() {\n  @SuppressWarnings("UnnecessaryLocalVariable")\n  List<ReactPackage> packages = new PackageList(this).getPackages();\n  // Packages that cannot be autolinked yet can be added manually here, for example:\n  // packages.add(new MyReactNativePackage());\n  packages.add(new CustomToastPackage()); // <-- Add this line with your package name.\n  return packages;\n}\n')),(0,n.kt)("p",null,"To access your new functionality from JavaScript, it is common to wrap the native module in a JavaScript module. This is not necessary but saves the consumers of your library the need to pull it off of ",(0,n.kt)("inlineCode",{parentName:"p"},"NativeModules")," each time. This JavaScript file also becomes a good location for you to add any JavaScript side functionality."),(0,n.kt)("p",null,"Create a new JavaScript file named ",(0,n.kt)("inlineCode",{parentName:"p"},"ToastExample.js")," with the content below:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"/**\n * This exposes the native ToastExample module as a JS module. This has a\n * function 'show' which takes the following parameters:\n *\n * 1. String message: A string with the text to toast\n * 2. int duration: The duration of the toast. May be ToastExample.SHORT or\n *    ToastExample.LONG\n */\nimport { NativeModules } from 'react-native';\nmodule.exports = NativeModules.ToastExample;\n")),(0,n.kt)("p",null,"Now, from your other JavaScript file you can call the method like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"import ToastExample from './ToastExample';\n\nToastExample.show('Awesome', ToastExample.SHORT);\n")),(0,n.kt)("p",null,"Please make sure this JavaScript is in the same hierarchy as ",(0,n.kt)("inlineCode",{parentName:"p"},"ToastExample.js"),"."),(0,n.kt)("h2",u({},{id:"beyond-toasts"}),"Beyond Toasts"),(0,n.kt)("h3",u({},{id:"callbacks"}),"Callbacks"),(0,n.kt)("p",null,"Native modules also support a unique kind of argument - a callback. In most cases it is used to provide the function call result to JavaScript."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"import com.facebook.react.bridge.Callback;\n\npublic class UIManagerModule extends ReactContextBaseJavaModule {\n\n...\n\n  @ReactMethod\n  public void measureLayout(\n      int tag,\n      int ancestorTag,\n      Callback errorCallback,\n      Callback successCallback) {\n    try {\n      measureLayout(tag, ancestorTag, mMeasureBuffer);\n      float relativeX = PixelUtil.toDIPFromPixel(mMeasureBuffer[0]);\n      float relativeY = PixelUtil.toDIPFromPixel(mMeasureBuffer[1]);\n      float width = PixelUtil.toDIPFromPixel(mMeasureBuffer[2]);\n      float height = PixelUtil.toDIPFromPixel(mMeasureBuffer[3]);\n      successCallback.invoke(relativeX, relativeY, width, height);\n    } catch (IllegalViewOperationException e) {\n      errorCallback.invoke(e.getMessage());\n    }\n  }\n\n...\n")),(0,n.kt)("p",null,"This method would be accessed in JavaScript using:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"UIManager.measureLayout(\n  100,\n  100,\n  (msg) => {\n    console.log(msg);\n  },\n  (x, y, width, height) => {\n    console.log(x + ':' + y + ':' + width + ':' + height);\n  }\n);\n")),(0,n.kt)("p",null,"A native module is supposed to invoke its callback only once. It can, however, store the callback and invoke it later."),(0,n.kt)("p",null,"It is very important to highlight that the callback is not invoked immediately after the native function completes - remember that bridge communication is asynchronous, and this too is tied to the run loop."),(0,n.kt)("h3",u({},{id:"promises"}),"Promises"),(0,n.kt)("p",null,"Native modules can also fulfill a promise, which can simplify your JavaScript, especially when using ES2016's ",(0,n.kt)("inlineCode",{parentName:"p"},"async/await")," syntax. When the last parameter of a bridged native method is a ",(0,n.kt)("inlineCode",{parentName:"p"},"Promise"),", its corresponding JS method will return a JS Promise object."),(0,n.kt)("p",null,"Refactoring the above code to use a promise instead of callbacks looks like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'import com.facebook.react.bridge.Promise;\n\npublic class UIManagerModule extends ReactContextBaseJavaModule {\n\n...\n  private static final String E_LAYOUT_ERROR = "E_LAYOUT_ERROR";\n  @ReactMethod\n  public void measureLayout(\n      int tag,\n      int ancestorTag,\n      Promise promise) {\n    try {\n      measureLayout(tag, ancestorTag, mMeasureBuffer);\n\n      WritableMap map = Arguments.createMap();\n\n      map.putDouble("relativeX", PixelUtil.toDIPFromPixel(mMeasureBuffer[0]));\n      map.putDouble("relativeY", PixelUtil.toDIPFromPixel(mMeasureBuffer[1]));\n      map.putDouble("width", PixelUtil.toDIPFromPixel(mMeasureBuffer[2]));\n      map.putDouble("height", PixelUtil.toDIPFromPixel(mMeasureBuffer[3]));\n\n      promise.resolve(map);\n    } catch (IllegalViewOperationException e) {\n      promise.reject(E_LAYOUT_ERROR, e);\n    }\n  }\n\n...\n')),(0,n.kt)("p",null,"The JavaScript counterpart of this method returns a Promise. This means you can use the ",(0,n.kt)("inlineCode",{parentName:"p"},"await")," keyword within an async function to call it and wait for its result:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"async function measureLayout() {\n  try {\n    var { relativeX, relativeY, width, height } =\n      await UIManager.measureLayout(100, 100);\n\n    console.log(\n      relativeX + ':' + relativeY + ':' + width + ':' + height\n    );\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nmeasureLayout();\n")),(0,n.kt)("h3",u({},{id:"threading"}),"Threading"),(0,n.kt)("p",null,"Native modules should not have any assumptions about what thread they are being called on, as the current assignment is subject to change in the future. If a blocking call is required, the heavy work should be dispatched to an internally managed worker thread, and any callbacks distributed from there."),(0,n.kt)("h3",u({},{id:"sending-events-to-javascript"}),"Sending Events to JavaScript"),(0,n.kt)("p",null,"Native modules can signal events to JavaScript without being invoked directly. The easiest way to do this is to use the ",(0,n.kt)("inlineCode",{parentName:"p"},"RCTDeviceEventEmitter")," which can be obtained from the ",(0,n.kt)("inlineCode",{parentName:"p"},"ReactContext")," as in the code snippet below."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'...\nimport com.facebook.react.modules.core.DeviceEventManagerModule;\nimport com.facebook.react.bridge.WritableMap;\nimport com.facebook.react.bridge.Arguments;\n...\nprivate void sendEvent(ReactContext reactContext,\n                       String eventName,\n                       @Nullable WritableMap params) {\n  reactContext\n      .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)\n      .emit(eventName, params);\n}\n...\nWritableMap params = Arguments.createMap();\nparams.putString("eventProperty", "someValue");\n...\nsendEvent(reactContext, "EventReminder", params);\n')),(0,n.kt)("p",null,"JavaScript modules can then register to receive events by ",(0,n.kt)("inlineCode",{parentName:"p"},"addListener")," on the NativeEventEmitter class."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-jsx"}),"import { NativeEventEmitter, NativeModules } from 'react-native';\n...\n\n  componentDidMount() {\n    ...\n    const eventEmitter = new NativeEventEmitter(NativeModules.ToastExample);\n    this.eventListener = eventEmitter.addListener('EventReminder', (event) => {\n       console.log(event.eventProperty) // \"someValue\"\n    });\n    ...\n  }\n\n  componentWillUnmount() {\n    this.eventListener.remove(); //Removes the listener\n  }\n")),(0,n.kt)("h3",u({},{id:"getting-activity-result-from-startactivityforresult"}),"Getting activity result from ",(0,n.kt)("inlineCode",{parentName:"h3"},"startActivityForResult")),(0,n.kt)("p",null,"You'll need to listen to ",(0,n.kt)("inlineCode",{parentName:"p"},"onActivityResult")," if you want to get results from an activity you started with ",(0,n.kt)("inlineCode",{parentName:"p"},"startActivityForResult"),". To do this, you must extend ",(0,n.kt)("inlineCode",{parentName:"p"},"BaseActivityEventListener")," or implement ",(0,n.kt)("inlineCode",{parentName:"p"},"ActivityEventListener"),". The former is preferred as it is more resilient to API changes. Then, you need to register the listener in the module's constructor,"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"reactContext.addActivityEventListener(mActivityResultListener);\n")),(0,n.kt)("p",null,"Now you can listen to ",(0,n.kt)("inlineCode",{parentName:"p"},"onActivityResult")," by implementing the following method:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"@Override\npublic void onActivityResult(\n  final Activity activity,\n  final int requestCode,\n  final int resultCode,\n  final Intent intent) {\n  // Your logic here\n}\n")),(0,n.kt)("p",null,"We will implement a basic image picker to demonstrate this. The image picker will expose the method ",(0,n.kt)("inlineCode",{parentName:"p"},"pickImage")," to JavaScript, which will return the path of the image when called."),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),'public class ImagePickerModule extends ReactContextBaseJavaModule {\n\n  private static final int IMAGE_PICKER_REQUEST = 1;\n  private static final String E_ACTIVITY_DOES_NOT_EXIST = "E_ACTIVITY_DOES_NOT_EXIST";\n  private static final String E_PICKER_CANCELLED = "E_PICKER_CANCELLED";\n  private static final String E_FAILED_TO_SHOW_PICKER = "E_FAILED_TO_SHOW_PICKER";\n  private static final String E_NO_IMAGE_DATA_FOUND = "E_NO_IMAGE_DATA_FOUND";\n\n  private Promise mPickerPromise;\n\n  private final ActivityEventListener mActivityEventListener = new BaseActivityEventListener() {\n\n    @Override\n    public void onActivityResult(Activity activity, int requestCode, int resultCode, Intent intent) {\n      if (requestCode == IMAGE_PICKER_REQUEST) {\n        if (mPickerPromise != null) {\n          if (resultCode == Activity.RESULT_CANCELED) {\n            mPickerPromise.reject(E_PICKER_CANCELLED, "Image picker was cancelled");\n          } else if (resultCode == Activity.RESULT_OK) {\n            Uri uri = intent.getData();\n\n            if (uri == null) {\n              mPickerPromise.reject(E_NO_IMAGE_DATA_FOUND, "No image data found");\n            } else {\n              mPickerPromise.resolve(uri.toString());\n            }\n          }\n\n          mPickerPromise = null;\n        }\n      }\n    }\n  };\n\n  ImagePickerModule(ReactApplicationContext reactContext) {\n    super(reactContext);\n\n    // Add the listener for `onActivityResult`\n    reactContext.addActivityEventListener(mActivityEventListener);\n  }\n\n  @Override\n  public String getName() {\n    return "ImagePickerModule";\n  }\n\n  @ReactMethod\n  public void pickImage(final Promise promise) {\n    Activity currentActivity = getCurrentActivity();\n\n    if (currentActivity == null) {\n      promise.reject(E_ACTIVITY_DOES_NOT_EXIST, "Activity doesn\'t exist");\n      return;\n    }\n\n    // Store the promise to resolve/reject when picker returns data\n    mPickerPromise = promise;\n\n    try {\n      final Intent galleryIntent = new Intent(Intent.ACTION_PICK);\n\n      galleryIntent.setType("image/*");\n\n      final Intent chooserIntent = Intent.createChooser(galleryIntent, "Pick an image");\n\n      currentActivity.startActivityForResult(chooserIntent, IMAGE_PICKER_REQUEST);\n    } catch (Exception e) {\n      mPickerPromise.reject(E_FAILED_TO_SHOW_PICKER, e);\n      mPickerPromise = null;\n    }\n  }\n}\n')),(0,n.kt)("h3",u({},{id:"listening-to-lifecycle-events"}),"Listening to LifeCycle events"),(0,n.kt)("p",null,"Listening to the activity's LifeCycle events such as ",(0,n.kt)("inlineCode",{parentName:"p"},"onResume"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"onPause")," etc. is very similar to how we implemented ",(0,n.kt)("inlineCode",{parentName:"p"},"ActivityEventListener"),". The module must implement ",(0,n.kt)("inlineCode",{parentName:"p"},"LifecycleEventListener"),". Then, you need to register a listener in the module's constructor,"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"reactContext.addLifecycleEventListener(this);\n")),(0,n.kt)("p",null,"Now you can listen to the activity's LifeCycle events by implementing the following methods:"),(0,n.kt)("pre",null,(0,n.kt)("code",u({parentName:"pre"},{className:"language-java"}),"@Override\npublic void onHostResume() {\n    // Activity `onResume`\n}\n\n@Override\npublic void onHostPause() {\n    // Activity `onPause`\n}\n\n@Override\npublic void onHostDestroy() {\n    // Activity `onDestroy`\n}\n")))}f.isMDXComponent=!0}}]);