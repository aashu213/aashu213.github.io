"use strict";(self.webpackChunkreact_native_website=self.webpackChunkreact_native_website||[]).push([[71051],{35318:function(e,t,r){r.d(t,{Zo:function(){return l},kt:function(){return p}});var n=r(27378);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var d=n.createContext({}),c=function(e){var t=n.useContext(d),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},l=function(e){var t=c(e.components);return n.createElement(d.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,d=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),h=c(r),p=a,m=h["".concat(d,".").concat(p)]||h[p]||u[p]||i;return r?n.createElement(m,o(o({ref:t},l),{},{components:r})):n.createElement(m,o({ref:t},l))}));function p(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=h;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<i;c++)o[c]=r[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}h.displayName="MDXCreateElement"},14043:function(e,t,r){r.d(t,{ZP:function(){return p}});var n=r(35318),a=Object.defineProperty,i=Object.defineProperties,o=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,l=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t)=>{for(var r in t||(t={}))d.call(t,r)&&l(e,r,t[r]);if(s)for(var r of s(t))c.call(t,r)&&l(e,r,t[r]);return e};const h={toc:[]};function p(e){var t,r=e,{components:a}=r,l=((e,t)=>{var r={};for(var n in e)d.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&s)for(var n of s(e))t.indexOf(n)<0&&c.call(e,n)&&(r[n]=e[n]);return r})(r,["components"]);return(0,n.kt)("wrapper",(t=u(u({},h),l),i(t,o({components:a,mdxType:"MDXLayout"}))),(0,n.kt)("div",u({},{className:"admonition admonition-caution alert alert--warning"}),(0,n.kt)("div",u({parentName:"div"},{className:"admonition-heading"}),(0,n.kt)("h5",{parentName:"div"},(0,n.kt)("span",u({parentName:"h5"},{className:"admonition-icon"}),(0,n.kt)("svg",u({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),(0,n.kt)("path",u({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"caution")),(0,n.kt)("div",u({parentName:"div"},{className:"admonition-content"}),(0,n.kt)("p",{parentName:"div"},"This document refers to the architecture of the new renderer, ",(0,n.kt)("a",u({parentName:"p"},{href:"fabric-renderer"}),"Fabric"),", that is in active roll-out."))))}p.isMDXComponent=!0},30251:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return p},contentTitle:function(){return m},metadata:function(){return f},toc:function(){return g},default:function(){return k}});var n=r(35318),a=r(14043),i=Object.defineProperty,o=Object.defineProperties,s=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t)=>{for(var r in t||(t={}))c.call(t,r)&&u(e,r,t[r]);if(d)for(var r of d(t))l.call(t,r)&&u(e,r,t[r]);return e};const p={id:"threading-model",title:"Threading Model"},m=void 0,f={unversionedId:"threading-model",id:"threading-model",title:"Threading Model",description:"The React Native renderer distributes the work of the render pipeline across multiple threads.",source:"@site/architecture/threading-model.md",sourceDirName:".",slug:"/threading-model",permalink:"/architecture/threading-model",editUrl:"https://github.com/facebook/react-native-website/blob/master/website/architecture/threading-model.md",tags:[],version:"current",lastUpdatedAt:1648760516,formattedLastUpdatedAt:"4/1/2022",frontMatter:{id:"threading-model",title:"Threading Model"},sidebar:"architecture",previous:{title:"View Flattening",permalink:"/architecture/view-flattening"},next:{title:"Glossary",permalink:"/architecture/glossary"}},g=[{value:"The React Native renderer distributes the work of the render pipeline across multiple threads.",id:"the-react-native-renderer-distributes-the-work-of-the-render-pipeline-across-multiple-threads",children:[],level:4},{value:"Render Scenarios",id:"render-scenarios",children:[{value:"Render in a Background Thread",id:"render-in-a-background-thread",children:[],level:3},{value:"Render in the UI Thread",id:"render-in-the-ui-thread",children:[],level:3},{value:"Default or continuous event interruption",id:"default-or-continuous-event-interruption",children:[],level:3},{value:"Discrete event interruption",id:"discrete-event-interruption",children:[],level:3},{value:"Background thread batches updates from JavaScript",id:"background-thread-batches-updates-from-javascript",children:[],level:3},{value:"C++ State update",id:"c-state-update",children:[],level:3}],level:2}],v={toc:g};function k(e){var t,r=e,{components:i}=r,u=((e,t)=>{var r={};for(var n in e)c.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&d)for(var n of d(e))t.indexOf(n)<0&&l.call(e,n)&&(r[n]=e[n]);return r})(r,["components"]);return(0,n.kt)("wrapper",(t=h(h({},v),u),o(t,s({components:i,mdxType:"MDXLayout"}))),(0,n.kt)(a.ZP,{mdxType:"FabricWarning"}),(0,n.kt)("h4",h({},{id:"the-react-native-renderer-distributes-the-work-of-the-render-pipeline-across-multiple-threads"}),"The React Native renderer distributes the work of the ",(0,n.kt)("a",h({parentName:"h4"},{href:"render-pipeline"}),"render pipeline")," across multiple threads."),(0,n.kt)("p",null,"Here we define the threading model and provide some examples to illustrate thread usage of the render pipeline."),(0,n.kt)("p",null,"React Native renderer is designed to be thread safe. At a high level thread safety is guaranteed by using immutable data structures in the internals of the framework (enforced by C++ \u201cconst correctness\u201d feature). This means that every update in React creates or clones new objects in the renderer instead of updating data structures. This allows the framework to expose thread safe and synchronous APIs to React."),(0,n.kt)("p",null,"The renderer uses three different threads:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"UI thread")," (often called main): The only thread that can manipulate host views."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"JavaScript thread"),": This is where React\u2019s render phase is executed."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Background thread"),": Thread dedicated to layout.")),(0,n.kt)("p",null,"Let\u2019s review the supported scenarios of execution for each phase:"),(0,n.kt)("figure",null,(0,n.kt)("img",{src:"/docs/assets/Architecture/threading-model/symbols.png",alt:"Threading model symbols"})),(0,n.kt)("h2",h({},{id:"render-scenarios"}),"Render Scenarios"),(0,n.kt)("h3",h({},{id:"render-in-a-background-thread"}),"Render in a Background Thread"),(0,n.kt)("p",null,"This is the most common scenario where most of the render pipeline happens on JavaScript and background thread."),(0,n.kt)("figure",null,(0,n.kt)("img",{src:"/docs/assets/Architecture/threading-model/case-1.jpg",alt:"Threading model use case one"})),(0,n.kt)("hr",null),(0,n.kt)("h3",h({},{id:"render-in-the-ui-thread"}),"Render in the UI Thread"),(0,n.kt)("p",null,"When there is a high priority event on the UI Thread, the renderer is able to execute all the render pipeline synchronously on the UI thread."),(0,n.kt)("figure",null,(0,n.kt)("img",{src:"/docs/assets/Architecture/threading-model/case-2.jpg",alt:"Threading model use case two"})),(0,n.kt)("hr",null),(0,n.kt)("h3",h({},{id:"default-or-continuous-event-interruption"}),"Default or continuous event interruption"),(0,n.kt)("p",null,"This scenario shows the interruption of the render phase by a low priority event in the UI thread. React and the React Native renderer are able to interrupt the render phase and merge its state with a low priority event that is executed on the UI thread. In this case the render process continues executing in the background thread."),(0,n.kt)("figure",null,(0,n.kt)("img",{src:"/docs/assets/Architecture/threading-model/case-3.jpg",alt:"Threading model use case three"})),(0,n.kt)("hr",null),(0,n.kt)("h3",h({},{id:"discrete-event-interruption"}),"Discrete event interruption"),(0,n.kt)("p",null,"The render phase is interruptible. This scenario shows the interruption of the render phase by a high priority event in the UI thread. React and the renderer are able to interrupt the render phase and merge its state with a high priority event that was executed on the UI thread. The render phase executes synchronously on the UI thread."),(0,n.kt)("figure",null,(0,n.kt)("img",{src:"/docs/assets/Architecture/threading-model/case-4.jpg",alt:"Threading model use case four"})),(0,n.kt)("hr",null),(0,n.kt)("h3",h({},{id:"background-thread-batches-updates-from-javascript"}),"Background thread batches updates from JavaScript"),(0,n.kt)("p",null,"Before background thread dispatches update to UI thread, it checks if a newer update hasn\u2019t come in from JavaScript. This way, the renderer doesn\u2019t render stale state when it knows a newer state is coming it."),(0,n.kt)("figure",null,(0,n.kt)("img",{src:"/docs/assets/Architecture/threading-model/case-5.jpg",alt:"Threading model use case five"})),(0,n.kt)("hr",null),(0,n.kt)("h3",h({},{id:"c-state-update"}),"C++ State update"),(0,n.kt)("p",null,"Update originating on UI thread and skips rendering phase. See ",(0,n.kt)("a",h({parentName:"p"},{href:"render-pipeline#react-native-renderer-state-updates"}),"React Native Renderer State Updates")," for more details."),(0,n.kt)("figure",null,(0,n.kt)("img",{src:"/docs/assets/Architecture/threading-model/case-6.jpg",alt:"Threading model use case six"})))}k.isMDXComponent=!0}}]);